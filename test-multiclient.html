<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Client Chess Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #2c2f33;
            color: white;
            padding: 20px;
        }
        .client-info {
            background: #23272a;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .client-name {
            font-size: 18px;
            font-weight: bold;
            color: #5865f2;
        }
        .client-id {
            font-size: 12px;
            color: #99aab5;
            font-family: monospace;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .status.connected {
            background: #2d7d32;
        }
        .status.disconnected {
            background: #d32f2f;
        }
        .clients-list {
            background: #23272a;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }
        .client-item {
            padding: 5px 0;
            border-bottom: 1px solid #444;
        }
        .messages {
            background: #23272a;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }
        .message {
            padding: 5px 0;
            font-size: 12px;
            font-family: monospace;
        }
        button {
            background: #5865f2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #4752c4;
        }
    </style>
</head>
<body>
    <h1>ðŸŽ¯ Multi-Client Chess Test</h1>
    
    <div class="client-info">
        <div class="client-name" id="clientName">Loading...</div>
        <div class="client-id" id="clientId">Loading...</div>
    </div>
    
    <div class="status disconnected" id="status">
        Disconnected
    </div>
    
    <div>
        <button onclick="connect()">Connect</button>
        <button onclick="disconnect()">Disconnect</button>
        <button onclick="testMove()">Test Move</button>
        <button onclick="resetGame()">Reset Game</button>
    </div>
    
    <div class="clients-list">
        <h3>ðŸ‘¥ Connected Clients</h3>
        <div id="clientsList">No clients connected</div>
    </div>
    
    <div class="messages">
        <h3>ðŸ“¡ Messages</h3>
        <div id="messagesList"></div>
    </div>

    <script>
        let ws = null;
        let clientId = null;
        let clientName = null;
        let sessionId = 'test_game_123';
        
        // Generate client info
        function generateClientId() {
            return 'client_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now().toString(36);
        }
        
        function generateClientName() {
            const adjectives = ['Swift', 'Clever', 'Bold', 'Wise', 'Quick', 'Sharp', 'Bright', 'Noble', 'Brave', 'Smart'];
            const nouns = ['Knight', 'Bishop', 'Rook', 'Queen', 'King', 'Pawn', 'Player', 'Master', 'Champion', 'Warrior'];
            const adjective = adjectives[Math.floor(Math.random() * adjectives.length)];
            const noun = nouns[Math.floor(Math.random() * nouns.length)];
            return `${adjective}${noun}`;
        }
        
        // Initialize client info
        clientId = generateClientId();
        clientName = generateClientName();
        
        document.getElementById('clientName').textContent = clientName;
        document.getElementById('clientId').textContent = clientId;
        
        function addMessage(msg) {
            const messagesList = document.getElementById('messagesList');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';
            messageDiv.textContent = `${new Date().toLocaleTimeString()}: ${JSON.stringify(msg)}`;
            messagesList.appendChild(messageDiv);
            messagesList.scrollTop = messagesList.scrollHeight;
        }
        
        function updateStatus(status) {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = status;
            statusDiv.className = status.toLowerCase().includes('connected') ? 'status connected' : 'status disconnected';
        }
        
        function updateClientsList(clients) {
            const clientsList = document.getElementById('clientsList');
            if (!clients || clients.length === 0) {
                clientsList.innerHTML = 'No clients connected';
                return;
            }
            
            clientsList.innerHTML = clients.map(client => 
                `<div class="client-item">
                    <strong>${client.clientName}</strong> 
                    <span style="color: #99aab5;">(${client.clientId})</span>
                </div>`
            ).join('');
        }
        
        function connect() {
            if (ws) {
                ws.close();
            }
            
            const wsUrl = `ws://localhost:3456`;
            ws = new WebSocket(wsUrl);
            
            ws.onopen = () => {
                updateStatus('Connected');
                addMessage({ type: 'connection', status: 'opened' });
                
                // Join session
                setTimeout(() => {
                    ws.send(JSON.stringify({
                        type: 'join_session',
                        sessionId: sessionId,
                        clientId: clientId,
                        clientName: clientName
                    }));
                }, 100);
            };
            
            ws.onmessage = (event) => {
                const message = JSON.parse(event.data);
                addMessage(message);
                
                switch (message.type) {
                    case 'clients_list':
                        updateClientsList(message.clients);
                        break;
                    case 'client_joined':
                        addMessage({ info: `Client joined: ${message.clientName}` });
                        break;
                    case 'client_left':
                        addMessage({ info: `Client left: ${message.clientName}` });
                        break;
                }
            };
            
            ws.onclose = () => {
                updateStatus('Disconnected');
                addMessage({ type: 'connection', status: 'closed' });
            };
            
            ws.onerror = (error) => {
                updateStatus('Error');
                addMessage({ type: 'error', error: error.message });
            };
        }
        
        function disconnect() {
            if (ws) {
                ws.close();
            }
        }
        
        function testMove() {
            if (!ws || ws.readyState !== WebSocket.OPEN) {
                alert('Not connected!');
                return;
            }
            
            // Send a test move via API
            fetch('/api/mcp/make_move', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    game_id: sessionId,
                    move: 'e2e4',
                    client_id: clientId,
                    client_name: clientName
                })
            })
            .then(response => response.json())
            .then(data => {
                addMessage({ api_response: data });
            })
            .catch(error => {
                addMessage({ api_error: error.message });
            });
        }
        
        function resetGame() {
            if (!ws || ws.readyState !== WebSocket.OPEN) {
                alert('Not connected!');
                return;
            }
            
            fetch('/api/mcp/reset_game', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    game_id: sessionId
                })
            })
            .then(response => response.json())
            .then(data => {
                addMessage({ reset_response: data });
            })
            .catch(error => {
                addMessage({ reset_error: error.message });
            });
        }
        
        // Auto-connect on load
        setTimeout(connect, 1000);
    </script>
</body>
</html> 